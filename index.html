<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Content-Security-Policy"
    content="script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline';">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tashgeel POS System</title>
  <link rel="stylesheet" href="css/styles.css">

</head>

<!-- ... (body content) ... -->



<body>
  <!-- Language Switcher -->
  <div class="language-switcher">
    <button class="lang-btn" data-lang="en" id="langEn">English</button>
    <button class="lang-btn" data-lang="ar" id="langAr">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</button>
  </div>

  <!-- Login Screen -->
  <div class="login-screen">
    <div class="license-container">
      <div class="version-badge">ENHANCED</div>
      <div class="pos-logo">üè™</div>
      <h1 id="loginTitle" data-i18n-key="shop_pos_system">Tashgeel POS System</h1>
      <p class="subtitle" id="subtitle" data-i18n-key="enhanced_security">Powered by itqan</p>

      <!-- System Status (SaaS Mode) -->
      <div id="activationInfo" style="text-align: center; margin-bottom: 20px;">
        <span style="color: #27ae60; font-weight: bold;">‚úÖ SaaS Subscription Active</span>
      </div>

      <!-- Login Form (shown when activated) -->
      <form class="login-form hidden" id="loginForm">
        <div class="form-group">
          <label id="businessEmailLabel" data-i18n-key="business_email">Business Email:</label>
          <input type="email" id="businessEmail" placeholder="owner@business.com" required />
        </div>
        <div class="form-group">
          <label id="usernameLabel" data-i18n-key="username">Username:</label>
          <input type="text" id="username" required />
        </div>
        <div class="form-group">
          <label id="passwordLabel" data-i18n-key="password">Password:</label>
          <input type="password" id="password" required />
        </div>
        <button type="submit" class="btn btn-success" id="loginBtn" data-i18n-key="login_btn">üöÄ Launch System</button>
        <div id="loginError" class="error"></div>

        <div style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 15px; text-align: center;">
          <p style="margin-bottom: 10px;">
            <a href="#" onclick="showRegisterModal(); return false;"
              style="color: #27ae60; text-decoration: none; font-weight: bold;" data-i18n-key="no_account">Register New
              Business</a>
          </p>
          <a href="super-admin.html" style="color: #666; text-decoration: none; font-size: 0.85em;"
            data-i18n-key="super_admin_login">üîê Super Admin Login</a>
        </div>
      </form>

      <!-- Security Features -->
      <div class="security-notice">
        <h3 id="securityFeaturesTitle" data-i18n-key="security_features">üîê Security Features</h3>
        <ul id="securityFeaturesList">
          <li id="feature1" data-i18n-key="feature1">One-time license activation</li>
          <li id="feature2" data-i18n-key="feature2">Encrypted data storage</li>
          <li id="feature3" data-i18n-key="feature3">Automatic secure backups</li>
          <li id="feature4" data-i18n-key="feature4">Multi-language support</li>
          <li id="feature5" data-i18n-key="feature5">Role-based access control</li>
          <li id="feature6" data-i18n-key="feature6">Receipt printing with logo</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Registration Modal -->
  <div id="registerModal" class="modal"
    style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); align-items:center; justify-content:center; z-index:2000;">
    <div class="modal-content" style="background:white; padding:30px; border-radius:10px; width:400px; max-width:90%;">
      <h3>Register New Business</h3>
      <form id="registerForm">
        <div class="form-group">
          <input type="text" id="regBusinessName" placeholder="Business Name" class="form-control" required
            style="width:100%; margin-bottom:10px; padding:8px;">
        </div>
        <div class="form-group">
          <input type="email" id="regEmail" placeholder="Owner Email" class="form-control" required
            style="width:100%; margin-bottom:10px; padding:8px;">
        </div>
        <div class="form-group">
          <input type="tel" id="regPhone" placeholder="Mobile Number" class="form-control" required
            style="width:100%; margin-bottom:10px; padding:8px;">
        </div>
        <div class="form-group">
          <input type="text" id="regUsername" placeholder="Admin Username" class="form-control" required
            style="width:100%; margin-bottom:10px; padding:8px;">
        </div>
        <div class="form-group">
          <input type="password" id="regPassword" placeholder="Password" class="form-control" required
            style="width:100%; margin-bottom:15px; padding:8px;">
        </div>
        <button type="submit" class="btn btn-primary" style="width:100%;">Create Account</button>
        <button type="button" onclick="document.getElementById('registerModal').style.display='none'"
          class="btn btn-secondary" style="width:100%; margin-top:10px;">Cancel</button>
      </form>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    Tashgheel POS¬© 2025</strong> |
    <a href="tel:+201126522373">+201126522373 / +201155253886</a>
    <span id="footerText" data-i18n-key="enhanced_security">Designed and developed by itqan</span>
  </div>





  <script src="js/web-adapter.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/translations.js"></script>
  <script>
    function copyMachineId() {
      const copyText = document.getElementById("fingerprintDisplay");
      if (copyText && copyText.value) {
        copyText.select();
        document.execCommand("copy");
        // Simple visual feedback
        const btn = document.querySelector('button[onclick="copyMachineId()"]');
        const originalText = btn.textContent;
        btn.textContent = "‚úÖ Copied!";
        setTimeout(() => btn.textContent = originalText, 2000);
      }
    }

    function initLogin() {
      // Show Login Form directly in SaaS Mode
      document.getElementById("loginForm").classList.remove("hidden");
    }


    document.addEventListener("DOMContentLoaded", async () => {
      // Data System auto-initializes via auth.js
      // await EnhancedSecurity.init(); // REMOVED (Legacy)
      initLogin();

      const loginForm = document.getElementById('loginForm');
      loginForm.addEventListener('submit', async function (e) {
        e.preventDefault();
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value.trim();
        const errorDiv = document.getElementById('loginError');

        if (await window.login(username, password)) {
          // Redirection/Branch Picker handled inside login()
        } else {
          errorDiv.textContent = '‚ùå Invalid username or password';
          errorDiv.style.color = 'red';
        }
      });
    });
  </script>
</body>

</html>